<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Clasificador en Tiempo Real</title>
  <style>
    video, canvas { display: block; margin: auto; }
    #output { text-align: center; font-size: 20px; margin-top: 10px; }
  </style>
</head>
<body>
  <h1 style="text-align:center;">Clasificaci√≥n en Tiempo Real</h1>
  <video id="video" width="640" height="480" autoplay></video>
  <canvas id="canvas" width="640" height="480" style="display:none;"></canvas>
  <div id="output">Esperando...</div>
  <button onclick="getSpeech()">Escuchar voz</button>
  <script src="static/app.js"></script>
<link rel="icon" href="/static/favicon.ico" type="image/x-icon">

<script>
  const video = document.getElementById("video");
  const canvas = document.getElementById("canvas");
  const output = document.getElementById("output");

  const ws = new WebSocket("ws://localhost:8000/ws/hand");

  ws.onmessage = (event) => {
    const data = JSON.parse(event.data);
    if (data.gesture) {
      output.innerText = "Gestura detectada: " + data.gesture;
    } else if (data.error) {
      output.innerText = "Error: " + data.error;
    }
  };

  function sendFrame() {
    const ctx = canvas.getContext("2d");
    ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
    canvas.toBlob((blob) => {
      if (blob) {
        blob.arrayBuffer().then(buffer => {
          ws.send(buffer);
        });
      }
    }, "image/jpeg");
  }

  navigator.mediaDevices.getUserMedia({ video: true })
    .then((stream) => {
      video.srcObject = stream;
      setInterval(sendFrame, 500); // send every 500ms
    })
    .catch((err) => {
      console.error("Error accessing webcam:", err);
    });

  async function getSpeech() {
    const res = await fetch("/api/speech");
    const data = await res.json();
    if (data.recognized) {
      output.innerText = "Voz reconocida: " + data.text;
    } else {
      output.innerText = data.message;
    }
  }
</script>

</body>
</html>

